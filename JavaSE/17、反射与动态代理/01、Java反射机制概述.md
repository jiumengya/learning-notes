Reflectionï¼ˆåå°„ï¼‰æ˜¯è¢«è§†ä¸ºåŠ¨æ€è¯­è¨€çš„å…³é”®ï¼Œåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨æ‰§è¡ŒæœŸé—´å€ŸåŠ©äºReflection APIå–å¾—ä»»ä½•ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼Œå¹¶èƒ½ç›´æ¥æ“ä½œä»»æ„å¯¹è±¡çš„å†…éƒ¨å±æ€§åŠæ–¹æ³•ã€‚

åŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨å †å†…å­˜çš„æ–¹æ³•åŒºä¸­å°±äº§ç”Ÿäº†ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ï¼ˆä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±åŒ…å«äº†å®Œæ•´çš„ç±»çš„ç»“æ„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çœ‹åˆ°ç±»çš„ç»“æ„ã€‚è¿™ä¸ªå¯¹è±¡å°±åƒä¸€é¢é•œå­ï¼Œé€è¿‡è¿™ä¸ªé•œå­çœ‹åˆ°ç±»çš„ç»“æ„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å½¢è±¡çš„ç§°ä¹‹ä¸ºï¼šåå°„ã€‚

æ¡†æ¶ = åå°„ + æ³¨è§£ + è®¾è®¡æ¨¡å¼

> åå°„çš„ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹**ï¼šå¯ä»¥åŠ¨æ€çš„åˆ›å»ºå’Œä½¿ç”¨å¯¹è±¡(ä¹Ÿæ˜¯æ¡†æ¶åº•å±‚æ ¸å¿ƒ),æ¯”è¾ƒçµæ´»ï¼Œæ²¡æœ‰åå°„æœºåˆ¶ï¼Œæ¡†æ¶æŠ€æœ¯å°±å¤±å»åº•å±‚æ”¯æŒã€‚

**ç¼ºç‚¹**ï¼šä½¿ç”¨åå°„åŸºæœ¬ä¸Šæ˜¯è§£é‡Šæ‰§è¡Œï¼Œå¯¹æ‰§è¡Œé€Ÿåº¦æœ‰å½±å“ã€‚



![img](./assets/image.png)

> 1ã€åŠ¨æ€è¯­è¨€

**æ˜¯ä¸€ç±»åœ¨è¿è¡Œæ—¶å¯ä»¥æ”¹å˜å…¶ç»“æ„çš„è¯­è¨€**ï¼šä¾‹å¦‚æ–°çš„å‡½æ•°ã€å¯¹è±¡ã€ç”šè‡³ä»£ç å¯ä»¥è¢«å¼•è¿›ï¼Œå·²æœ‰çš„å‡½æ•°å¯ä»¥è¢«åˆ é™¤æˆ–æ˜¯å…¶ä»–ç»“æ„ä¸Šçš„å˜åŒ–ã€‚é€šä¿—ç‚¹è¯´å°±æ˜¯åœ¨è¿è¡Œæ—¶ä»£ç å¯ä»¥æ ¹æ®æŸäº›æ¡ä»¶æ”¹å˜è‡ªèº«ç»“æ„ã€‚ä¸»è¦åŠ¨æ€è¯­è¨€ï¼šObject-Cã€C#ã€JavaScriptã€PHPã€Pythonã€Erlangã€‚

> 2ã€é™æ€è¯­è¨€

ä¸åŠ¨æ€è¯­è¨€ç›¸å¯¹åº”çš„ï¼Œ**è¿è¡Œæ—¶ç»“æ„ä¸å¯å˜çš„è¯­è¨€å°±æ˜¯é™æ€è¯­è¨€**ã€‚å¦‚Javaã€Cã€C++ã€‚

- Javaä¸æ˜¯åŠ¨æ€è¯­è¨€ï¼Œä½†Javaå¯ä»¥ç§°ä¹‹ä¸ºâ€œå‡†åŠ¨æ€è¯­è¨€â€ã€‚å³Javaæœ‰ä¸€å®šçš„åŠ¨æ€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶ã€å­—èŠ‚ç æ“ä½œè·å¾—ç±»ä¼¼åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ã€‚Javaçš„åŠ¨æ€æ€§è®©ç¼–ç¨‹çš„æ—¶å€™æ›´åŠ çµæ´»ï¼
- Javaåå°„æœºåˆ¶æä¾›çš„åŠŸèƒ½
  - åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»
  - åœ¨è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡
  - åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•
  - åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•
  - åœ¨è¿è¡Œæ—¶è·å–æ³›å‹ä¿¡æ¯
  - åœ¨è¿è¡Œæ—¶å¤„ç†æ³¨è§£
  - ç”ŸæˆåŠ¨æ€ä»£ç†
  - å¯ä»¥è°ƒç”¨ç§æœ‰æˆå‘˜
- åå°„ç›¸å…³çš„ä¸»è¦API
  - `java.lang.Class`:ä»£è¡¨ä¸€ä¸ªç±»
  - `java.lang.reflect.Method`:ä»£è¡¨ç±»çš„æ–¹æ³•
  - `java.lang.reflect.Field`:ä»£è¡¨ç±»çš„æˆå‘˜å˜é‡
  - `java.lang.reflect.Constructor`:ä»£è¡¨ç±»çš„æ„é€ å™¨

> æµ‹è¯•ç±»

```java
import org.junit.Test;

public class ReflectionTest { 

    //åå°„ä¹‹å‰ï¼Œå¯¹äºPersonçš„æ“ä½œ
    @Test
    public void test(){ 

        //1.åˆ›å»ºç±»çš„å¯¹è±¡
        Person p1 = new Person("jay",21);

        //2.è°ƒç”¨å¯¹è±¡,è°ƒç”¨å…¶å†…éƒ¨çš„å±æ€§å’Œæ–¹æ³•
        p1.age = 15;
        System.out.println(p1.toString());

        p1.show();

        //åœ¨Personç±»çš„å¤–éƒ¨ï¼Œä¸å¯ä»¥é€šè¿‡Personç±»çš„å¯¹è±¡è°ƒç”¨å…¶å†…éƒ¨ç§æœ‰çš„ç»“æ„ã€‚
        //æ¯”å¦‚ï¼šnameã€showNationä»¥åŠç§æœ‰çš„æ„é€ å™¨ã€‚
      
    }
}
```

> Personç±»

```java
package github;

public class Person { 
    private String name;
    public int age;

    public String getName() { 
        return name;
    }

    public void setName(String name) { 
        this.name = name;
    }

    public int getAge() { 
        return age;
    }

    public void setAge(int age) { 
        this.age = age;
    }

    public Person() { 
    }

    public Person(String name, int age) { 
        this.name = name;
        this.age = age;
    }

    private Person(String name) { 
        this.name = name;
    }

    @Override
    public String toString() { 
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }

    public void show(){ 
        System.out.println("ä½ å¥½ï¼Œæˆ‘æ˜¯ğŸ””");
    }

    private String showNation(String nation){ 
        System.out.println("å–·å­å®åœ¨å¤ªå¤šäº†ï¼ï¼ï¼" + nation);
        return nation;
    }
}
```

## 1.1ã€ä½¿ç”¨åå°„ï¼Œå®ç°åŒä¸Šçš„æ“ä½œ

```java
import org.junit.Test;

import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

public class ReflectionTest { 

    //åå°„ä¹‹å ï¼Œå †ä¸Personçš„æ“ä½œ
    @Test
    public void test2() throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException { 
        Class clazz = Person.class;
        //1.é€šè¿‡åå°„ï¼Œåˆ›å»ºPersonç±»çš„å¯¹è±¡
        //è·å–æ„é€ å™¨
        Constructor cons = clazz.getConstructor(String.class,int.class);
        //åˆ›å»ºå®ä¾‹
        Object obj = cons.newInstance("Jon",18);
        Person p = (Person) obj;
        System.out.println(p.toString());
        //2.é€šè¿‡åå°„ï¼Œè°ƒç”¨å¯¹è±¡æŒ‡å®šçš„å±æ€§å’Œæ–¹æ³•
        //è°ƒç”¨å…¬å…±å±æ€§
        Field age = clazz.getDeclaredField("age");
        age.set(p,10);
        System.out.println(p.toString());

        //è°ƒç”¨å…¬å…±æ–¹æ³•
        Method show = clazz.getDeclaredMethod("show");
        show.invoke(p);

    }
}
```

## 1.2ã€åå°„çš„å¼ºå¤§ï¼šè°ƒç”¨ç±»çš„ç§æœ‰ç»“æ„

```text
1.Methodã€Fieldã€Constructorå¯¹è±¡éƒ½æœ‰setAccessible()æ–¹æ³•
2.setAccessibleä½œç”¨æ˜¯å¯åŠ¨å’Œç¦ç”¨å®‰å…¨æ£€æŸ¥çš„å¼€å…³
3.å‚æ•°å€¼ä¸ºtrueè¡¨ç¤ºåå°„çš„å¯¹è±¡åœ¨ä½¿ç”¨æ—¶å–æ¶ˆè®¿é—®æ£€æŸ¥ï¼Œæé«˜åå°„çš„æ•ˆç‡ã€‚
åŒæ—¶ä¹Ÿèƒ½è®¿é—®ç§æœ‰ç»“æ„
4.å‚æ•°å€¼ä¸ºfalseåˆ™è¡¨ç¤ºåå°„çš„å¯¹è±¡æ‰§è¡Œè®¿é—®æ£€æŸ¥ã€‚
import org.junit.Test;

import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class ReflectionTest { 
     //åå°„ä¹‹å ï¼Œå †ä¸Personçš„æ“ä½œ
    @Test
    public void test2() throws Exception{ 
       
        System.out.println("+++++++++++++++++++++++++");

        //é€šè¿‡åå°„ï¼Œæ˜¯å¯ä»¥è°ƒç”¨Personç±»çš„ç§æœ‰ç»“æ„çš„ã€‚æ¯”å¦‚ï¼šç§æœ‰çš„æ„é€ å™¨ã€æ–¹æ³•ã€å±æ€§
        //è°ƒç”¨ç§æœ‰çš„æ„é€ å™¨
        Constructor cons2 = clazz.getDeclaredConstructor(String.class);
        //å–æ¶ˆè®¿é—®æ£€æŸ¥
        cons2.setAccessible(true);
        Person p1 = (Person) cons2.newInstance("kalo");
        System.out.println(p1);

        //è°ƒç”¨ç§æœ‰çš„å±æ€§
        Field name = clazz.getDeclaredField("name");
        name.setAccessible(true);
        name.set(p1,"Taoyao");
        System.out.println(p1);

        //è°ƒç”¨ç§æœ‰çš„æ–¹æ³•
        Method showNation = clazz.getDeclaredMethod("LiNin", String.class);
        showNation.setAccessible(true);
        String nation = (String) showNation.invoke(p1,"FaceBook");
        //ç›¸å½“äºString nation = p1.showNation("FaceBook")
        System.out.println(nation);
    }

    /**
     * ç–‘é—®1ï¼šé€šè¿‡ç›´æ¥newçš„æ–¹å¼æˆ–åå°„çš„æ–¹å¼éƒ½å¯ä»¥è°ƒç”¨å…¬å…±çš„ç»“æ„ï¼Œå¼€å‘ä¸­åˆ°åº•ç”¨é‚£ä¸ªï¼Ÿ
     * å»ºè®®ï¼šç›´æ¥newçš„æ–¹å¼ã€‚
     * ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨ï¼šåå°„çš„æ–¹å¼ã€‚ åå°„çš„ç‰¹å¾ï¼šåŠ¨æ€æ€§
     * å³å¦‚æœæˆ‘ä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸ç¡®å®šè¦åˆ›å»ºè°çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„æ¥è§£å†³
     * ä¾‹å¦‚å‰å°ä¼ è¿‡æ¥ä¸€ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬æ ¹æ®åˆ¤æ–­æ¥ç¡®å®šæ˜¯ç™»å½•è¿˜æ˜¯æ³¨å†Œ
     * ç–‘é—®2ï¼šåå°„æœºåˆ¶ä¸é¢å‘å¯¹è±¡ä¸­çš„å°è£…æ€§æ˜¯ä¸æ˜¯çŸ›ç›¾çš„ï¼Ÿå¦‚ä½•çœ‹å¾…ä¸¤ä¸ªæŠ€æœ¯ï¼Ÿ
     * ä¸çŸ›ç›¾ã€‚å¯ä»¥ç†è§£ä¸ºå°è£…æ˜¯ä¸æƒ³è®©äººç›´æ¥è°ƒç”¨ï¼Œå¦‚æœéè¦è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ï¼Œå³åå°„
     */
}
```